<!DOCTYPE html>
<html lang="de">

<head>
  <meta charset="UTF-8">
  <style>
    body {
      font-family: 'Times New Roman', serif;
      font-size: 10pt;
      line-height: 1.3;
      margin: 0;
      padding: 20px;
      color: #000;
    }

    .header {
      text-align: center;
      margin-bottom: 25px;
      border-bottom: 2px solid #000;
      padding-bottom: 10px;
    }

    .header h1 {
      margin: 0 0 8px 0;
      font-size: 16pt;
      font-weight: bold;
      color: #000;
      letter-spacing: 0.5px;
    }

    .header .subtitle {
      font-size: 11pt;
      color: #000;
      margin: 3px 0;
      font-weight: normal;
    }

    .company-info {
      margin-bottom: 20px;
      border: 1px solid #000;
      padding: 10px;
    }

    .company-info h3 {
      margin: 0 0 8px 0;
      font-size: 11pt;
      color: #000;
      text-transform: uppercase;
      letter-spacing: 0.3px;
    }

    .summary-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 25px;
      border: 2px solid #000;
    }

    .summary-table th,
    .summary-table td {
      padding: 8px;
      border: 1px solid #000;
      text-align: left;
    }

    .summary-table th {
      background-color: #f0f0f0;
      font-weight: bold;
      font-size: 10pt;
      text-transform: uppercase;
    }

    .summary-table .amount {
      text-align: right;
      font-family: 'Times New Roman', serif;
      font-weight: bold;
    }

    .main-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
      border: 2px solid #000;
    }

    .main-table th,
    .main-table td {
      padding: 6px 8px;
      border: 1px solid #000;
      text-align: left;
      font-size: 9pt;
    }

    .main-table th {
      background-color: #f0f0f0;
      font-weight: bold;
      text-transform: uppercase;
      letter-spacing: 0.3px;
    }

    .main-table .amount {
      text-align: right;
      font-family: 'Times New Roman', serif;
    }

    .section-header {
      background-color: #e0e0e0;
      font-weight: bold;
      font-size: 11pt;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      text-align: center;
    }

    .category-total {
      font-weight: bold;
      background-color: #f0f0f0;
      border-top: 2px solid #000;
      border-bottom: 2px solid #000;
    }

    .final-total {
      font-weight: bold;
      background-color: #d0d0d0;
      border: 3px solid #000;
      font-size: 11pt;
    }

    .monthly-summary {
      margin-top: 25px;
    }

    .monthly-summary h3 {
      margin: 0 0 10px 0;
      font-size: 12pt;
      color: #000;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      border-bottom: 2px solid #000;
      padding-bottom: 5px;
    }

    .legal-notice {
      margin-top: 25px;
      font-size: 8pt;
      color: #000;
      line-height: 1.2;
      border-top: 2px solid #000;
      padding-top: 10px;
      text-align: justify;
    }

    .page-break {
      page-break-before: always;
    }

    /* Remove all colors - official documents are black and white */
    * {
      color: #000 !important;
    }

    .footer {
      position: fixed;
      bottom: 15px;
      left: 20px;
      right: 20px;
      font-size: 7pt;
      color: #000;
      text-align: center;
      border-top: 1px solid #000;
      padding-top: 5px;
    }
  </style>
</head>

<body>

  <div class="header">
    <h1>Anlage EÜR - Einnahme-Überschuss-Rechnung</h1>
    <div class="subtitle">Geschäftsjahr {{ year }}</div>
    <div class="subtitle">Erstellt am {{ creation_date.strftime('%d.%m.%Y') }}</div>
  </div>

  <div class="company-info">
    <h3>Steuerpflichtiger</h3>
    <div>
      <strong>{{ company_data.unternehmen_name }}</strong><br>
      {{ company_data.unternehmen_adresse }}<br>
      {{ company_data.unternehmen_plz }} {{ company_data.unternehmen_ort }}<br>
      {% if company_data.unternehmen_steuernummer %}
      Steuernummer: {{ company_data.unternehmen_steuernummer }}
      {% endif %}
    </div>
  </div>

  <!-- Summary Table -->
  <table class="summary-table">
    <thead>
      <tr>
        <th>Pos.</th>
        <th>Bezeichnung</th>
        <th>Betrag (EUR)</th>
      </tr>
    </thead>
    <tbody>
      <tr class="section-header">
        <td colspan="3">BETRIEBSEINNAHMEN</td>
      </tr>
      {% for category_name, entries in income_categories.items() %}
      <tr>
        <td>{{ loop.index }}</td>
        <td>{{ category_name }} ({{ entries|length }} Buchungen)</td>
        <td class="amount">{{ (entries|sum(attribute='betrag'))|german_decimal }}</td>
      </tr>
      {% endfor %}
      <tr class="category-total">
        <td></td>
        <td><strong>Summe Betriebseinnahmen</strong></td>
        <td class="amount"><strong>{{ total_income|german_decimal }}</strong></td>
      </tr>

      <tr class="section-header">
        <td colspan="3">BETRIEBSAUSGABEN</td>
      </tr>
      {% for category_name, entries in expense_categories.items() %}
      <tr>
        <td>{{ loop.index + income_categories|length }}</td>
        <td>{{ category_name }} ({{ entries|length }} Buchungen)</td>
        <td class="amount">{{ (entries|sum(attribute='betrag'))|german_decimal }}</td>
      </tr>
      {% endfor %}
      <tr class="category-total">
        <td></td>
        <td><strong>Summe Betriebsausgaben</strong></td>
        <td class="amount"><strong>{{ total_expenses|german_decimal }}</strong></td>
      </tr>

      <tr class="final-total">
        <td></td>
        <td><strong>GEWINN/VERLUST (§ 4 Abs. 3 EStG)</strong></td>
        <td class="amount"><strong>{{ profit|german_decimal }}</strong></td>
      </tr>
    </tbody>
  </table>

  <!-- Monthly Overview -->
  {% if monthly_data %}
  <div class="monthly-summary">
    <h3>Monatliche Aufstellung</h3>
    <table class="main-table">
      <thead>
        <tr>
          <th>Monat</th>
          <th>Einnahmen (EUR)</th>
          <th>Ausgaben (EUR)</th>
          <th>Saldo (EUR)</th>
        </tr>
      </thead>
      <tbody>
        {% for month_key, data in monthly_data.items() %}
        <tr>
          <td>{{ month_key }}</td>
          <td class="amount">{{ data.income|german_decimal }}</td>
          <td class="amount">{{ data.expenses|german_decimal }}</td>
          <td class="amount">{{ data.balance|german_decimal }}</td>
        </tr>
        {% endfor %}
        <tr class="category-total">
          <td><strong>Gesamt</strong></td>
          <td class="amount"><strong>{{ total_income|german_decimal }}</strong></td>
          <td class="amount"><strong>{{ total_expenses|german_decimal }}</strong></td>
          <td class="amount"><strong>{{ profit|german_decimal }}</strong></td>
        </tr>
      </tbody>
    </table>
  </div>
  {% endif %}

  <div class="legal-notice">
    <strong>Erklärung:</strong> Die Einnahme-Überschuss-Rechnung wurde nach § 4 Abs. 3 des Einkommensteuergesetzes
    erstellt.
    Die Gewinnermittlung erfolgt nach dem Zufluss-Abfluss-Prinzip (§ 11 EStG). Sämtliche Angaben wurden nach bestem
    Wissen und Gewissen
    erstellt. Für die Richtigkeit und Vollständigkeit der Angaben wird die Verantwortung übernommen.
    <br><br>
    <strong>Datum der Erstellung:</strong> {{ creation_date.strftime('%d.%m.%Y') }}
    <br>
    <strong>Erstellt durch:</strong> {{ company_data.unternehmen_name }}
  </div>

  <div class="footer">
    Seite 1 | Anlage EÜR {{ year }} | {{ company_data.unternehmen_name }}
  </div>

</body>

</html>